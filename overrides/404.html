{#
  Custom 404 Page for MkDocs Material
  -----------------------------------
  - Displays a clear 404 message and instructions for the user.
  - Features a wide, compact search bar with a visible search button below the input.
  - Automatically extracts a readable search term from the URL (keeps commas, colons, apostrophes, lowercases text, removes other special chars except accents) and pre-fills the search box.
  - Uses Material theme color variables for seamless integration.
  - All layout and logic are self-contained in this file.
#}
{% extends "main.html" %}

<!-- Content -->
{% block content %}
<div style="text-align: center; padding: 2rem 0;">
  <h1>404 - Page Not Found</h1>
  
  <p style="margin-bottom: 2rem; color: var(--md-default-fg-color--light);">
    The page you're looking for doesn't exist. Some URLs have changed. Try searching with:
  </p>
  
  <!-- Custom search form -->
  <div style="max-width: 750px; margin: 0 auto;">
    <form class="md-search__form" name="search" action="{{ 'search.html' | url }}" method="get" style="display: flex; flex-direction: column; align-items: stretch; gap: 0.5rem;">
      <div style="position: relative; flex: 1; display: flex; align-items: center;">
        <input 
          type="text" 
          name="q" 
          class="md-search__input" 
          placeholder="Search the documentation..." 
          aria-label="Search the documentation"
          autocapitalize="off" 
          autocorrect="off" 
          autocomplete="off" 
          spellcheck="false"
          style="
            width: 100%;
            padding-top: 0.6rem;
            padding-bottom: 0.6rem;
            padding-left: 1rem;
            padding-right: 1rem;
            border: 2px solid var(--md-primary-fg-color);
            border-radius: 0.5rem;
            background: var(--md-default-bg-color);
            color: var(--md-default-fg-color);
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s ease;
          "
          onfocus="this.style.borderColor='var(--md-accent-fg-color)'"
          onblur="this.style.borderColor='var(--md-primary-fg-color)'"
        >
        <div style="
          position: absolute;
          left: 0.5rem;
          color: var(--md-default-fg-color--light);
          pointer-events: none;
        ">
          <svg width="20" height="20" viewBox="0 0 24 24">
            <path fill="currentColor" d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
          </svg>
        </div>
      </div>
      <button 
        type="submit" 
        style="
          margin: 0 auto;
          background: var(--md-primary-fg-color);
          color: var(--md-primary-bg-color);
          border: none;
          border-radius: 0.25rem;
          padding: 0.4rem 1.5rem;
          font-size: 1rem;
          cursor: pointer;
          transition: background-color 0.2s ease;
          display: block;
        "
        onmouseover="this.style.background='var(--md-accent-fg-color)'"
        onmouseout="this.style.background='var(--md-primary-fg-color)'"
      >
        Search
      </button>
    </form>
  </div>
</div>

<script>
// Function to extract readable page name from URI
function extractReadablePageName() {
  const currentUrl = window.location.href;
  const url = new URL(currentUrl);
  
  // Get the pathname and remove leading/trailing slashes
  let pathname = url.pathname.replace(/^\/+|\/+$/g, '');
  
  // If it's empty, try to get from referrer
  if (!pathname && document.referrer) {
    try {
      const referrerUrl = new URL(document.referrer);
      pathname = referrerUrl.pathname.replace(/^\/+|\/+$/g, '');
    } catch (e) {
      console.log('Could not parse referrer URL');
    }
  }
  
  if (!pathname) {
    return null;
  }
  
  // Remove .html extension if present
  pathname = pathname.replace(/\.html$/, '');
  
  // URL decode the pathname
  let decodedPath = decodeURIComponent(pathname);
  
  // Split by slashes and get the last part (the filename)
  const parts = decodedPath.split('/');
  let filename = parts[parts.length - 1];
  
  // If filename is empty, try the second to last part
  if (!filename && parts.length > 1) {
    filename = parts[parts.length - 2];
  }
  
  if (!filename) {
    return null;
  }
  
  // Clean up the filename to make it readable
  let readableName = filename
    // Replace underscores and hyphens with spaces
    .replace(/[_-]/g, ' ')
    // Replace multiple spaces with single space
    .replace(/\s+/g, ' ')
    // Remove all special chars except , : ' and keep accented letters
    .replace(/[^\w\s\u00C0-\u017F,:']/g, '')
    // Lowercase the text
    .toLowerCase()
    .trim();
  
  // If the result is empty or too short, return null
  if (!readableName || readableName.length < 2) {
    return null;
  }
  
  return readableName;
}

// Function to pre-fill search box with extracted page name
function prefillSearchBox() {
  const readableName = extractReadablePageName();
  
  if (readableName) {
    const searchInput = document.querySelector('input[name="q"]');
    if (searchInput) {
      searchInput.value = readableName;
      searchInput.placeholder = readableName;
    }
  }
}

document.addEventListener('DOMContentLoaded', prefillSearchBox);
</script>
{% endblock %}